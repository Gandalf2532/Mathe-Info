<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heheheha</title>
    <style>
        svg {
            background-color: rgb(252, 252, 252);
            border: 5px solid black;
            border-radius: 5px;
        }

        .gitterlinie {
            stroke: gray;
            stroke-width: 10;
        }

        table {
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        table input{
            color: black;
            border:none;
            text-align: center;
        }
        label input{
            border:none;
            font-size: 10px;
            
        }
        label{
            font-size: medium;
            border: 5px black solid;
            height: 200px;
        }

        th,td {
            border: 1px solid black;
            padding: 5px;
            text-align: center;
        }

        .punkt {
            fill:red;
        }

        .achsen {
            stroke: black;
            stroke-width: 10;
        }
        .textfeldx{
            stroke: black;
            font-size: 10%;
            font-size: 30px;
        }
        .textfeldy{
            stroke: black;
            font-size: 10%;
            font-size: 15px;
        }
        .beschriftung{
            stroke: black;
            font-size: 10%;
            font-size: 15px;
        }
        .eingabe{
            width: 50px;
            height: 20px;
        }
        .button{
            margin: 20px;
            float: right;
            padding: 10px;
            border: 2px solid black;
            border-radius: 15px;

        }
        .graph{
            stroke-width: 1%;
            stroke:black;
        }
    </style>
</head>
<body>
    <label>Die Anzahl der x-Werte:<input type="number" class="eingabe" id="eingabe-werte" value="10" min="2"></label><br>
    <table>
        <thead>
            Funktionstabelle
        </thead>
        <tr id="x-werte">

        </tr>
        <tr id="y-Reihe">
        </tr>
    </table>
    <button onclick="werteberechnung(), zeichne()" class="button" id="button">Abschicken</button>
    <svg id="svg1" viewBox=" 0 0 0 0">
        <defs>
            <pattern id="grid" class="gitterlinie" patternUnits="userSpaceOnUse" width="50" height="50">
                <path class="gitterlinie" d="M 50 0 L 0 0 0 50" fill="none"/>
            </pattern>
        </defs>
        <rect class="gitterlinie" width="100%" height="100%" fill="url(#grid)" id="gitterrect"/>
        <g id="Achsengruppe">
        </g>
        <g id="Beschriftung"></g>
        <g id="graphen"></g>
        <g id="Punkte">
        </g>
    </svg>
    <script>
        var xReihe = document.getElementById("x-werte");
        let yReihe = document.getElementById("y-Reihe");
        let svgpunkte = document.getElementById("Punkte");
        let svgele = document.getElementById("svg1");
        let svgviewbox = svgele.viewBox.baseVal;
        let gitter = document.getElementById("gitterrect");
        let xachse = document.getElementById("x-Achse");
        let yachse = document.getElementById("y-Achse");
        let funktionswerte = [];
        var allepunktex = [];
        var allepunktey = [];
        var alleYWerte = [];
        let zellen = [];
        let minx;
        let maxx;
        let miny;
        let maxy;
        let achsengruppe = document.getElementById("Achsengruppe");
        let eingabefürinputs = document.getElementById("eingabe-werte"); //Mir fallen keine Namen mehr ein

        function inputserstellen(){  //erstellt die inputs in der x-Reihe. Menge abhängig des Inputfeldes mit der id=eingabe-wert
            if(eingabefürinputs.value <= 2){
                eingabefürinputs.value  =  2;
            }
            xReihe.innerHTML = ""; //cleart die x-Reihe
            var th = document.createElement("th");
            th.innerText = "X-Wert"; //schreibt den th neu
            xReihe.appendChild(th);
            for(let i = 0; i<eingabefürinputs.value; i++){
                let input = document.createElement("input");
                input.type = "number";
                input.className = "eingabe";
                try{  //versucht die Werte aus der alten xReihe zu verwenden
                    input.value = zellen[i].value; 
                }
                catch(err){  //wenn alte werte nicht existieren, wird einfach i verwendet
                    input.value = i;  //i sollte ausgetauscht werden
                }
                let td = document.createElement("td");
                td.appendChild(input);
                xReihe.appendChild(td);
            }

            zellen = Array.from(document.getElementById("x-werte").getElementsByTagName("input"));

            //eventListener Hinzufügen
            for(let i=0; i<zellen.length; i++){
                zellen[i].addEventListener('input', () => {
                    werteberechnung();
                    zeichne();
                });
            }
            werteberechnung();
        }
        function werteberechnung(){ // Soll die Funktionswerte berechnen
            zellen = Array.from(document.getElementById("x-werte").getElementsByTagName("input")); //Array erstellen. Muss an der Stelle sein, damit die x-Werte schon existieren
            yReihe.innerHTML = ""; //cleart die y-Reihe
            var th = document.createElement("th");
            th.innerText = "Y-Wert"; //schreibt den th neu
            yReihe.appendChild(th);
            for (let i = 0; i < zellen.length; i++) { //füllt die tabelle aus
                var xwert = Number(zellen[i].value);
                var werte = zellen[i].value;
                var ywert = 0.5 * (werte ** 2) - 2 * werte - 4;
                alleYWerte[i] = ywert;
                var td = document.createElement('td');
                td.innerText = ywert;
                funktionswerte[i] = ywert;
                yReihe.appendChild(td);
            }
        }
        function zeichne(){
            allepunktex = [];
            allepunktey = [];
            achsengruppe.innerHTML = "";
            Beschriftung.innerHTML = "";
            svgpunkte.innerHTML = "";
            var zellen = Array.from(document.getElementById("x-werte").getElementsByTagName("input"));
            for (i = 0; i < zellen.length; i++) {
                let punkt = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                var xwert = Number(zellen[i].value);
                var ywert = Number(alleYWerte[i]);
                var punktx = xwert * 25;
                var punkty = -ywert * 25;
                allepunktex[i] = punktx;
                allepunktey[i] = punkty;
                minx = Math.min(...allepunktex);
                maxx = Math.max(...allepunktex);
                miny = Math.min(...allepunktey);
                maxy = Math.max(...allepunktey);
                let widths = Math.abs(minx) + Math.abs(maxx);
                let heights = Math.abs(miny) + Math.abs(maxy);

                svgele.setAttribute("height", Math.abs(heights + 50));
                svgele.setAttribute("width", Math.abs(widths + 50));
                svgele.setAttribute("x", minx);
                svgele.setAttribute("y", maxy);

                //${} ist für dynamischen string. Wird ersetzt durch das Ergebnis der Rechnung dadrin
                svgele.setAttribute("viewBox", `${minx - 50} ${miny - 50} ${widths + 100} ${heights + 100}`);//

                //Gitterlinien machen
                gitter.setAttribute("x", minx - 50);
                gitter.setAttribute("y", miny - 100);
                gitter.setAttribute("width", widths + 200);
                gitter.setAttribute("height", heights + 200);
                
                //Punkte erstellen und setzen
                punkt.setAttribute("cx", punktx);
                punkt.setAttribute("cy", punkty);
                punkt.setAttribute("r", 3);
                punkt.setAttribute("class", "punkt");
                svgpunkte.appendChild(punkt);
                
                //Graphen erstellen
            };
            zeichneLinie();
            

            
           
                
            

            //Achsen erschaffen
            let xAchse = document.createElementNS("http://www.w3.org/2000/svg", "line");
            let yAchse = document.createElementNS("http://www.w3.org/2000/svg", "line");

            //Beschriftung erstellen
            for (let i = 0; i < zellen.length; i++) {
                let text = document.createElementNS("http://www.w3.org/2000/svg", "text");
                let beschriftungx = Number(zellen[i].value);
                let positionx = allepunktex[i];
                if (beschriftungx == 0) {
                    text.setAttribute("x", positionx + 10);
                    text.setAttribute("y", 30);
                    text.setAttribute("class", "textfeldx");
                    text.innerHTML = beschriftungx;
                    Beschriftung.appendChild(text);
                }else {
                    text.setAttribute("x", positionx - 10);
                    text.setAttribute("y", 30);
                    text.setAttribute("class", "textfeldx");
                    text.innerHTML = beschriftungx;
                    Beschriftung.appendChild(text);
                }
            }

            let textbeschriftungx = document.createElementNS("http://www.w3.org/2000/svg", "text");
            textbeschriftungx.setAttribute("x", maxx);
            textbeschriftungx.setAttribute("y", -20);
            textbeschriftungx.setAttribute("class", "beschriftung");
            textbeschriftungx.innerHTML = "x-Achse";
            Beschriftung.appendChild(textbeschriftungx);

            for (let i = 0; i < zellen.length; i++) {
                let text = document.createElementNS("http://www.w3.org/2000/svg", "text");
                let beschriftungy = Number(alleYWerte[i]);
                let positiony = Number(allepunktey[i]);
                if (beschriftungy == 0) { }
                else {
                    text.setAttribute("x", -35);
                    text.setAttribute("y", positiony);
                    text.setAttribute("class", "beschriftung");
                    text.innerHTML = beschriftungy;
                    Beschriftung.appendChild(text);
                }
            }

            let textbeschriftungy = document.createElementNS("http://www.w3.org/2000/svg", "text");
            textbeschriftungy.setAttribute("x", 20);
            textbeschriftungy.setAttribute("y", miny - 20);
            textbeschriftungy.setAttribute("class", "textfeldy");
            textbeschriftungy.innerHTML = "y-Achse";
            Beschriftung.appendChild(textbeschriftungy);

            // Achsen-Eigenschaften setzen
            xAchse.setAttribute("x1", minx - 50);
            xAchse.setAttribute("x2", maxx + 50);
            xAchse.setAttribute("y1", 0);
            xAchse.setAttribute("y2", 0);
            xAchse.setAttribute("class", "achsen");

            yAchse.setAttribute("x1", 0);
            yAchse.setAttribute("x2", 0);
            yAchse.setAttribute("y1", miny - 100);
            yAchse.setAttribute("y2", maxy + 100);
            yAchse.setAttribute("class", "achsen");

            // Achsen zum SVG hinzufügen
            achsengruppe.appendChild(xAchse);
            achsengruppe.appendChild(yAchse);
        }

        eingabefürinputs.addEventListener('change', () => {
            inputserstellen();
            werteberechnung();
            zeichne();
        }); 
        function zeichneLinie(){
            let path = document.createElementNS("http://www.w3.org/2000/svg", "path");
            let d = `M ${allepunktex[0]} ${allepunktey[0]}`;
            console.log(allepunktex);
            for(let i=1; i<allepunktex.length -1; i++){
                let xc = (allepunktex[i] + allepunktex[i+1])/2;
                let yc = (allepunktey[i] + allepunktey[i+1])/2;
                d += ` Q ${allepunktex[i]} ${allepunktey[i]}, ${xc} ${yc}`;
            }
            console.log(d);
            d += ` T ${allepunktex[allepunktex.length-1]} ${allepunktey[allepunktey.length-1]} `;
            path.setAttribute("d", d);
            path.setAttribute("class", "graph");
            path.setAttribute("fill", "none");
            path.setAttribute("stroke-width", "3");
                
            graphen.appendChild(path);
            }   
        //tabelleSetup();
        inputserstellen();
        werteberechnung();
        zeichne();
    </script>
</body>
</html>